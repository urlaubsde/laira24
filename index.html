<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÿßŸÑŸÑŸäÿ±ÿ© 24</title>
    
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#163300">
    <link rel="apple-touch-icon" href="./assets/icon.png">

    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Cairo', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .num-en {
            font-family: sans-serif;
            direction: ltr;
            display: inline-block;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .transition-all-300 {
            transition: all 0.3s ease-in-out;
        }
        /* Install Banner Animations */
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .install-banner {
            animation: slideDown 0.5s ease-out forwards;
        }

        /* Animations */
        @keyframes pulse-green {
            0% { background-color: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.4); }
            100% { background-color: transparent; border-color: transparent; }
        }
        @keyframes pulse-red {
            0% { background-color: rgba(244, 63, 94, 0.1); border-color: rgba(244, 63, 94, 0.4); }
            100% { background-color: transparent; border-color: transparent; }
        }
        .animate-up { animation: pulse-green 1s ease-out; }
        .animate-down { animation: pulse-red 1s ease-out; }
        
        .chart-path {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: draw 1.5s ease-out forwards;
        }
        @keyframes draw {
            to { stroke-dashoffset: 0; }
        }

        /* *** ÿ•ÿ∂ÿßŸÅÿßÿ™ ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸàŸÖŸäÿ∂ ŸÑŸÑÿ®ÿ∑ÿßŸÇÿßÿ™ (Glow Effects) *** */
        @keyframes glow-pulse-green {
            0%, 100% { 
                border-color: rgba(16, 185, 129, 0.3); 
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            }
            50% { 
                border-color: #2ed06e; 
                box-shadow: 0 0 15px rgba(46, 208, 110, 0.5), inset 0 0 10px rgba(46, 208, 110, 0.1);
            }
        }
        @keyframes glow-pulse-red {
            0%, 100% { 
                border-color: rgba(244, 63, 94, 0.3); 
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            }
            50% { 
                border-color: #f43f5e; 
                box-shadow: 0 0 15px rgba(244, 63, 94, 0.5), inset 0 0 10px rgba(244, 63, 94, 0.1);
            }
        }
        /* ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ£ŸÜŸäŸÖŸäÿ¥ŸÜ */
        .card-glow-up { animation: glow-pulse-green 3s infinite ease-in-out; }
        .card-glow-down { animation: glow-pulse-red 3s infinite ease-in-out; }

    </style>
    
    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#163300', 
                            primary: '#2ed06e',
                            light: '#9fe870',
                            bg: '#f3f4f6',
                            card: '#ffffff'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 text-gray-900 transition-colors duration-300">
    <div id="root"></div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered!', reg))
                    .catch(err => console.log('SW Failed', err));
            });
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        
        // --- Config ---
        const SUPABASE_URL = "https://xcmovzkbpumvufvmahew.supabase.co"; 
        const ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhjbW92emticHVtdnVmdm1haGV3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2MTc2MjYsImV4cCI6MjA3OTE5MzYyNn0.aLxh6TSQ6pznFoeWpgnbdDYv1eJBNKtcdonyLhzJUZs";
        const CURRENCY_API_KEY = "cur_live_CDxQbX4wFRag1Je6lH4NbngQ3ifR7dRF4bQR6azA";
        const GLOBAL_CACHE_DURATION = 45 * 60 * 1000;
        const SPREAD_PERCENTAGE = 0.005;

        const GLOBAL_DISPLAY_MAP = {
            USD: { name: "ÿØŸàŸÑÿßÿ± ÿ£ŸÖÿ±ŸäŸÉŸä", flag: "üá∫üá∏" },
            EUR: { name: "ŸäŸàÿ±Ÿà", flag: "üá™üá∫" },
            GBP: { name: "ÿ¨ŸÜŸäŸá ÿ•ÿ≥ÿ™ÿ±ŸÑŸäŸÜŸä", flag: "üá¨üáß" },
            TRY: { name: "ŸÑŸäÿ±ÿ© ÿ™ÿ±ŸÉŸäÿ©", flag: "üáπüá∑" },
            SAR: { name: "ÿ±ŸäÿßŸÑ ÿ≥ÿπŸàÿØŸä", flag: "üá∏üá¶" },
            AED: { name: "ÿØÿ±ŸáŸÖ ÿ•ŸÖÿßÿ±ÿßÿ™Ÿä", flag: "üá¶üá™" },
            KWD: { name: "ÿØŸäŸÜÿßÿ± ŸÉŸàŸäÿ™Ÿä", flag: "üá∞üáº" },
            QAR: { name: "ÿ±ŸäÿßŸÑ ŸÇÿ∑ÿ±Ÿä", flag: "üá∂üá¶" },
            JOD: { name: "ÿØŸäŸÜÿßÿ± ÿ£ÿ±ÿØŸÜŸä", flag: "üáØüá¥" },
            CAD: { name: "ÿØŸàŸÑÿßÿ± ŸÉŸÜÿØŸä", flag: "üá®üá¶" },
            AUD: { name: "ÿØŸàŸÑÿßÿ± ÿ£ÿ≥ÿ™ÿ±ÿßŸÑŸä", flag: "üá¶üá∫" },
            JPY: { name: "ŸäŸÜ Ÿäÿßÿ®ÿßŸÜŸä", flag: "üáØüáµ" },
            RUB: { name: "ÿ±Ÿàÿ®ŸÑ ÿ±Ÿàÿ≥Ÿä", flag: "üá∑üá∫" },
            CNY: { name: "ŸäŸàÿßŸÜ ÿµŸäŸÜŸä", flag: "üá®üá≥" }
        };

        // ********** API **********
        async function fetchSupabaseData(viewName) {
            try {
                const url = `${SUPABASE_URL}/rest/v1/${viewName}?select=*`;
                const res = await fetch(url, { 
                    headers: { "apikey": ANON_KEY, "Authorization": "Bearer " + ANON_KEY }
                });
                if (!res.ok) return [];
                return await res.json();
            } catch (error) {
                console.error("Error fetching data:", error);
                return [];
            }
        }

        // --- Icons ---
        const Icons = {
            Home: () => <i data-lucide="home" className="w-6 h-6"></i>,
            Chart: () => <i data-lucide="bar-chart-2" className="w-6 h-6"></i>,
            Send: () => <i data-lucide="send" className="w-6 h-6"></i>,
            Coins: () => <i data-lucide="coins" className="w-6 h-6"></i>,
            Settings: () => <i data-lucide="settings" className="w-5 h-5"></i>,
            Globe: () => <i data-lucide="globe" className="w-6 h-6"></i>,
            Refresh: () => <i data-lucide="refresh-cw" className="w-4 h-4"></i>,
            Moon: () => <i data-lucide="moon" className="w-5 h-5"></i>,
            Sun: () => <i data-lucide="sun" className="w-5 h-5"></i>,
            Check: () => <i data-lucide="check" className="w-4 h-4"></i>,
            Calculator: () => <i data-lucide="calculator" className="w-5 h-5"></i>,
            TrendUp: () => <i data-lucide="trending-up" className="w-3 h-3"></i>,
            TrendDown: () => <i data-lucide="trending-down" className="w-3 h-3"></i>,
            Minus: () => <i data-lucide="minus" className="w-3 h-3"></i>,
            Shield: () => <i data-lucide="shield-check" className="w-6 h-6"></i>,
            Zap: () => <i data-lucide="zap" className="w-6 h-6"></i>,
            Wallet: () => <i data-lucide="wallet" className="w-6 h-6"></i>,
            X: () => <i data-lucide="x" className="w-5 h-5"></i>,
            Clock: () => <i data-lucide="clock" className="w-4 h-4"></i>,
            Target: () => <i data-lucide="target" className="w-4 h-4"></i>,
            ArrowDownUp: () => <i data-lucide="arrow-up-down" className="w-4 h-4"></i>,
            Download: () => <i data-lucide="download" className="w-5 h-5"></i>,
            Move: () => <i data-lucide="move" className="w-4 h-4"></i>,
            ArrowUp: () => <i data-lucide="arrow-up" className="w-5 h-5"></i>,
            ArrowDown: () => <i data-lucide="arrow-down" className="w-5 h-5"></i>,
            Info: () => <i data-lucide="info" className="w-4 h-4"></i>,
            Gem: () => <i data-lucide="gem" className="w-4 h-4"></i>,
            Camera: () => <i data-lucide="camera" className="w-4 h-4"></i>,
            Facebook: () => <i data-lucide="facebook" className="w-6 h-6"></i>
        };

        const IconRenderer = ({ icon }) => {
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            });
            return <span className="inline-flex items-center justify-center icon-wrapper">
                {icon()}
            </span>;
        };

        // --- Screenshot Logic ---
        const handleScreenshot = async (elementId, title) => {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            try {
                await new Promise(resolve => setTimeout(resolve, 100));
                
                const canvas = await html2canvas(element, {
                    scale: 3, 
                    useCORS: true,
                    backgroundColor: null,
                    windowWidth: 700, 
                    onclone: (clonedDoc) => {
                        const clonedElement = clonedDoc.getElementById(elementId);
                        if (clonedElement) {
                            clonedElement.style.width = '480px';
                            clonedElement.style.minWidth = '480px';
                            clonedElement.style.maxWidth = '480px';
                            clonedElement.style.padding = '30px'; 
                            
                            const headerContainer = clonedElement.querySelector('.flex.justify-between.items-start');
                            if (headerContainer) {
                                headerContainer.style.display = 'flex';
                                headerContainer.style.alignItems = 'flex-start';
                                headerContainer.style.gap = '20px'; 
                            }

                            const iconContainer = headerContainer?.querySelector('.w-16.h-16.rounded-full');
                            if (iconContainer) {
                                iconContainer.style.minWidth = '64px';
                                iconContainer.style.minHeight = '64px';
                                iconContainer.style.marginLeft = '10px';
                            }

                            const textContainer = headerContainer?.querySelector('div:nth-child(2)');
                            if (textContainer) {
                                textContainer.style.flexGrow = '1';
                                textContainer.style.minWidth = '0'; 
                            }

                            const titleElement = clonedElement.querySelector('h2');
                            if (titleElement) {
                                titleElement.style.whiteSpace = 'nowrap'; 
                                titleElement.style.fontSize = '26px';
                                titleElement.style.marginBottom = '5px';
                            }

                            const badgeContainer = titleElement?.nextElementSibling;
                            if (badgeContainer) {
                                badgeContainer.style.marginTop = '8px';
                                badgeContainer.style.marginBottom = '10px';
                            }

                            const isDark = document.documentElement.classList.contains('dark');
                            clonedElement.style.backgroundColor = isDark ? '#1f2937' : '#ffffff';
                            clonedElement.style.borderRadius = '30px';
                        }
                    },
                    ignoreElements: (node) => {
                        return node.classList.contains('screenshot-exclude');
                    }
                });

                const link = document.createElement('a');
                link.download = `Lira24-${title}-${new Date().getTime()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            } catch (error) {
                console.error("Screenshot failed:", error);
            }
        };

        // --- Components ---
        const generateChartData = (basePrice, points = 20, volatility = 0.02) => {
            let data = [];
            let current = basePrice;
            for (let i = 0; i < points; i++) {
                if (i === points - 1) data.push(basePrice);
                else {
                    const change = current * (Math.random() * volatility - (volatility / 2));
                    current += change;
                    data.push(current);
                }
            }
            return data;
        };

        const LineChart = ({ data, color = "#2ed06e", height = 120, showAxis = true }) => {
            if (!data || data.length === 0) return null;
            const width = 300;
            const padding = 5;
            const min = Math.min(...data);
            const max = Math.max(...data);
            const range = max - min || 1;
            const points = data.map((val, i) => {
                const x = (i / (data.length - 1)) * width;
                const y = height - ((val - min) / range) * (height - padding * 2) - padding;
                return `${x},${y}`;
            }).join(' ');
            const areaPoints = `${points} ${width},${height} 0,${height}`;

            return (
                <div className="w-full relative select-none" style={{ height: height + 'px' }}>
                    <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-full overflow-visible">
                        <defs>
                            <linearGradient id={`chartGradient-${color}`} x1="0" x2="0" y1="0" y2="1">
                                <stop offset="0%" stopColor={color} stopOpacity="0.4" />
                                <stop offset="100%" stopColor={color} stopOpacity="0" />
                            </linearGradient>
                        </defs>
                        <path d={`M ${areaPoints}`} fill={`url(#chartGradient-${color})`} stroke="none" />
                        <path d={`M ${points}`} fill="none" stroke={color} strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="chart-path" />
                        <circle cx={width} cy={height - ((data[data.length - 1] - min) / range) * (height - padding * 2) - padding} r="4" fill={color} stroke="white" strokeWidth="2" />
                    </svg>
                    {showAxis && (
                        <>
                            <div className="absolute top-0 left-0 text-[10px] text-gray-400 font-mono bg-white/80 dark:bg-gray-800/80 px-1 rounded">High: {max.toLocaleString('en-US', {maximumFractionDigits: 0})}</div>
                            <div className="absolute bottom-0 left-0 text-[10px] text-gray-400 font-mono bg-white/80 dark:bg-gray-800/80 px-1 rounded">Low: {min.toLocaleString('en-US', {maximumFractionDigits: 0})}</div>
                        </>
                    )}
                </div>
            );
        };

        const formatLastUpdate = (dateObj) => {
            if (!dateObj) return "Now";
            return dateObj.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
        };

        const calculateChange = (currentPrice, previousPrice) => {
            if (!previousPrice || parseFloat(previousPrice) === 0) return { percent: 0, direction: 'neutral' };
            const oldPrice = parseFloat(previousPrice);
            const current = parseFloat(currentPrice);
            const diff = current - oldPrice;
            const percent = (diff / oldPrice) * 100;
            return { percent: Math.abs(percent).toFixed(2), direction: diff > 0 ? 'up' : 'down' };
        };

        const getFlagAndCode = (name) => {
            if (name.includes("ÿØŸàŸÑÿßÿ±")) return { flag: "üá∫üá∏", code: "USD" };
            if (name.includes("ŸäŸàÿ±Ÿà")) return { flag: "üá™üá∫", code: "EUR" };
            if (name.includes("ÿ™ÿ±ŸÉŸä")) return { flag: "üáπüá∑", code: "TRY" };
            if (name.includes("ÿ≥ÿπŸàÿØŸä")) return { flag: "üá∏üá¶", code: "SAR" };
            if (name.includes("ÿ•ŸÖÿßÿ±ÿßÿ™Ÿä")) return { flag: "üá¶üá™", code: "AED" };
            if (name.includes("ÿ£ÿ±ÿØŸÜŸä")) return { flag: "üáØüá¥", code: "JOD" };
            if (name.includes("ŸÖÿµÿ±Ÿä")) return { flag: "üá™üá¨", code: "EGP" };
            if (name.includes("ŸÉŸàŸäÿ™Ÿä")) return { flag: "üá∞üáº", code: "KWD" };
            if (name.includes("ÿ∞Ÿáÿ®")) return { flag: "üèÜ", code: "GOLD" };
            return { flag: "üåç", code: "GBL" };
        };

        // --- Elegant Close Button ---
        const ElegantCloseButton = ({ onClick }) => (
            <button 
                onClick={onClick} 
                className="screenshot-exclude group relative flex items-center justify-center w-10 h-10 rounded-full bg-white/60 dark:bg-gray-800/60 backdrop-blur-md border border-gray-200/50 dark:border-gray-600/50 shadow-sm transition-all duration-300 hover:bg-red-50 hover:border-red-200 hover:text-red-500 dark:hover:bg-red-900/20 dark:hover:border-red-900/30 dark:hover:text-red-400 hover:scale-110 active:scale-95 z-50"
            >
                <div className="transition-transform duration-300 group-hover:rotate-90">
                    <IconRenderer icon={Icons.X} />
                </div>
            </button>
        );

        // --- Currency Modal ---
        const CurrencyDetailModal = ({ currency, onClose, onMove, time }) => {
            if (!currency) return null;
            const { flag, code } = getFlagAndCode(currency.name);
            const isUp = currency.stats?.direction === 'up';
            const sell = parseFloat(currency.sell_price);
            const buy = parseFloat(currency.buy_price);
            const spread = sell - buy;
            const reverseRate = sell > 0 ? (1 / sell).toFixed(7) : 0;
            const chartData = useMemo(() => generateChartData(sell, 15, 0.01), [sell]);

            return (
                <div className="fixed inset-0 z-[70] flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200" onClick={onClose}>
                    <div id="currency-modal-card" className="bg-white dark:bg-gray-800 w-full max-w-sm rounded-3xl p-6 shadow-2xl border border-gray-100 dark:border-gray-700 relative overflow-hidden animate-in zoom-in-95 slide-in-from-bottom-10 duration-300" onClick={e => e.stopPropagation()}>
                        
                        <div className="flex justify-between items-start mb-6 relative z-10">
                            <div className="flex items-center gap-4">
                                <div className="w-16 h-16 rounded-full bg-gray-50 dark:bg-gray-700 flex items-center justify-center text-4xl shadow-inner border border-gray-100 dark:border-gray-600">{flag}</div>
                                <div>
                                    <h2 className="text-xl font-bold text-gray-800 dark:text-white">{currency.name}</h2>
                                    <div className="flex items-center gap-2">
                                        <span className="bg-brand-primary/10 text-brand-primary text-xs font-bold px-2 py-0.5 rounded-full">{code}</span>
                                        <span className="text-xs text-gray-400 font-mono">1 {code} = {sell.toLocaleString('en-US')} SYP</span>
                                    </div>
                                </div>
                            </div>
                            <ElegantCloseButton onClick={onClose} />
                        </div>

                        <div className="absolute top-20 left-0 right-0 opacity-10 pointer-events-none">
                            <LineChart data={chartData} color={isUp ? "#2ed06e" : "#ef4444"} height={100} showAxis={false} />
                        </div>

                        <div className="grid grid-cols-2 gap-4 mb-6 relative z-10">
                            <div className="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-2xl border border-gray-100 dark:border-gray-600">
                                <span className="text-xs text-gray-400 block mb-1">ÿ≥ÿπÿ± ÿßŸÑŸÖÿ®Ÿäÿπ</span>
                                <span className={`text-xl font-bold num-en ${isUp ? 'text-brand-dark dark:text-brand-light' : 'text-red-500'}`}>{sell.toLocaleString('en-US')}</span>
                            </div>
                            <div className="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-2xl border border-gray-100 dark:border-gray-600">
                                <span className="text-xs text-gray-400 block mb-1">ÿ≥ÿπÿ± ÿßŸÑÿ¥ÿ±ÿßÿ°</span>
                                <span className="text-xl font-bold num-en text-brand-primary">{buy.toLocaleString('en-US')}</span>
                            </div>
                        </div>

                        <div className="space-y-3 mb-6 relative z-10">
                            <div className="flex justify-between items-center py-2 border-b border-dashed border-gray-200 dark:border-gray-700">
                                <span className="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2"><IconRenderer icon={Icons.Clock} />ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´</span>
                                <span className="font-mono font-bold text-gray-700 dark:text-gray-200 num-en">{formatLastUpdate(time)}</span>
                            </div>
                             <div className="flex justify-between items-center py-2 border-b border-dashed border-gray-200 dark:border-gray-700">
                                <span className="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2"><IconRenderer icon={Icons.Calculator} />ÿ≥ÿπÿ± ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿπŸÉÿ≥Ÿä</span>
                                <div className="text-right">
                                    <span className="font-mono font-bold text-gray-700 dark:text-gray-200 num-en block">{reverseRate}</span>
                                    <span className="text-[10px] text-gray-400">1 ŸÑŸäÿ±ÿ© ÿ≥Ÿàÿ±Ÿäÿ© = {code}</span>
                                </div>
                            </div>
                            <div className="flex justify-between items-center py-2 border-b border-dashed border-gray-200 dark:border-gray-700">
                                <span className="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2"><IconRenderer icon={Icons.Info} />ÿßŸÑŸÅÿßÿ±ŸÇ (Spread)</span>
                                <span className="font-mono font-bold text-gray-700 dark:text-gray-200 num-en">{spread.toLocaleString('en-US')} <span className="text-[10px]">ŸÑ.ÿ≥</span></span>
                            </div>
                        </div>

                        <div className="flex gap-2 screenshot-exclude">
                            <button 
                                onClick={() => handleScreenshot('currency-modal-card', code)}
                                className="flex-1 bg-brand-primary hover:bg-brand-light text-brand-dark rounded-xl p-3 flex items-center justify-center gap-2 font-bold text-xs transition"
                            >
                                <IconRenderer icon={Icons.Camera} /> ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©
                            </button>
                            <div className="flex-1 bg-gray-100 dark:bg-gray-900 rounded-xl p-3 flex justify-between items-center">
                                <span className="text-[10px] font-bold text-gray-500">ÿ™ÿ±ÿ™Ÿäÿ®:</span>
                                <div className="flex gap-2">
                                    <button onClick={() => onMove(code, -1)} className="p-1 rounded bg-white dark:bg-gray-700 shadow-sm"><IconRenderer icon={Icons.ArrowUp} /></button>
                                    <button onClick={() => onMove(code, 1)} className="p-1 rounded bg-white dark:bg-gray-700 shadow-sm"><IconRenderer icon={Icons.ArrowDown} /></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Gold Modal ---
        const GoldDetailModal = ({ gold, onClose, onMove, time }) => {
            if (!gold) return null;
            const sell = parseFloat(gold.sell_price);
            const buy = parseFloat(gold.buy_price);
            const spread = sell - buy;
            const chartData = useMemo(() => generateChartData(sell, 15, 0.015), [sell]);
            const goldKey = gold.description;

            return (
                <div className="fixed inset-0 z-[70] flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200" onClick={onClose}>
                    <div id="gold-modal-card" className="bg-white dark:bg-gray-800 w-full max-w-sm rounded-3xl p-6 shadow-2xl border border-brand-primary/20 dark:border-brand-primary/10 relative overflow-hidden animate-in zoom-in-95 slide-in-from-bottom-10 duration-300" onClick={e => e.stopPropagation()}>
                        
                        <div className="flex justify-between items-start mb-6 relative z-10">
                            <div className="flex items-center gap-4">
                                <div className="w-16 h-16 rounded-full bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 flex items-center justify-center text-4xl shadow-inner border border-yellow-200 dark:border-yellow-700">üèÜ</div>
                                <div>
                                    <h2 className="text-xl font-bold text-gray-800 dark:text-white">{gold.description}</h2>
                                    <div className="flex items-center gap-2">
                                        <span className="bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-400 text-xs font-bold px-2 py-0.5 rounded-full">GOLD</span>
                                        <span className="text-xs text-gray-400 font-mono">ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿµÿßÿ∫ÿ©</span>
                                    </div>
                                </div>
                            </div>
                            <ElegantCloseButton onClick={onClose} />
                        </div>

                        <div className="absolute top-20 left-0 right-0 opacity-10 pointer-events-none">
                            <LineChart data={chartData} color="#eab308" height={100} showAxis={false} />
                        </div>

                        <div className="grid grid-cols-2 gap-4 mb-6 relative z-10">
                            <div className="bg-yellow-50/50 dark:bg-gray-700/50 p-4 rounded-2xl border border-yellow-100 dark:border-gray-600">
                                <span className="text-xs text-gray-400 block mb-1">ÿ≥ÿπÿ± ÿßŸÑŸÖÿ®Ÿäÿπ</span>
                                <span className="text-xl font-bold num-en text-gray-800 dark:text-white">{sell.toLocaleString('en-US')}</span>
                            </div>
                            <div className="bg-yellow-50/50 dark:bg-gray-700/50 p-4 rounded-2xl border border-yellow-100 dark:border-gray-600">
                                <span className="text-xs text-gray-400 block mb-1">ÿ≥ÿπÿ± ÿßŸÑÿ¥ÿ±ÿßÿ°</span>
                                <span className="text-xl font-bold num-en text-yellow-600">{buy.toLocaleString('en-US')}</span>
                            </div>
                        </div>

                        <div className="space-y-3 mb-6 relative z-10">
                            <div className="flex justify-between items-center py-2 border-b border-dashed border-gray-200 dark:border-gray-700">
                                <span className="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2"><IconRenderer icon={Icons.Clock} />ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´</span>
                                <span className="font-mono font-bold text-gray-700 dark:text-gray-200 num-en">{formatLastUpdate(time)}</span>
                            </div>
                             <div className="flex justify-between items-center py-2 border-b border-dashed border-gray-200 dark:border-gray-700">
                                <span className="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2"><IconRenderer icon={Icons.Gem} />ÿπŸäÿßÿ± ÿßŸÑÿ∞Ÿáÿ®</span>
                                <span className="font-mono font-bold text-gray-700 dark:text-gray-200">{gold.description}</span>
                            </div>
                            <div className="flex justify-between items-center py-2 border-b border-dashed border-gray-200 dark:border-gray-700">
                                <span className="text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2"><IconRenderer icon={Icons.Info} />ŸÅÿ±ŸÇ ÿßŸÑÿµŸäÿßÿ∫ÿ© (Spread)</span>
                                <span className="font-mono font-bold text-gray-700 dark:text-gray-200 num-en">{spread.toLocaleString('en-US')} <span className="text-[10px]">ŸÑ.ÿ≥</span></span>
                            </div>
                        </div>

                         <div className="flex gap-2 screenshot-exclude">
                            <button 
                                onClick={() => handleScreenshot('gold-modal-card', gold.description)}
                                className="flex-1 bg-brand-primary hover:bg-brand-light text-brand-dark rounded-xl p-3 flex items-center justify-center gap-2 font-bold text-xs transition"
                            >
                                <IconRenderer icon={Icons.Camera} /> ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©
                            </button>
                            <div className="flex-1 bg-gray-100 dark:bg-gray-900 rounded-xl p-3 flex justify-between items-center">
                                <span className="text-[10px] font-bold text-gray-500">ÿ™ÿ±ÿ™Ÿäÿ®:</span>
                                <div className="flex gap-2">
                                    <button onClick={() => onMove(goldKey, -1)} className="p-1 rounded bg-white dark:bg-gray-700 shadow-sm"><IconRenderer icon={Icons.ArrowUp} /></button>
                                    <button onClick={() => onMove(goldKey, 1)} className="p-1 rounded bg-white dark:bg-gray-700 shadow-sm"><IconRenderer icon={Icons.ArrowDown} /></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // *** REDESIGNED RATE CARD (With Glow Effect) ***
        const RateCard = ({ title, buy, sell, icon, code, stats, time, onClick, draggable, onDragStart, onDragEnter, onDragEnd }) => {
            const isUp = stats?.direction === 'up';
            const isDown = stats?.direction === 'down';
            
            // Dynamic Glow Logic
            const glowClass = isUp ? 'card-glow-up' : isDown ? 'card-glow-down' : 'border-gray-100 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-500';
            
            const trendIcon = isUp ? Icons.TrendUp : isDown ? Icons.TrendDown : Icons.Minus;
            const trendTextColor = isUp ? 'text-emerald-600 dark:text-emerald-400' : isDown ? 'text-rose-600 dark:text-rose-400' : 'text-gray-400';
            const trendBgColor = isUp ? 'bg-emerald-50 dark:bg-emerald-900/20' : isDown ? 'bg-rose-50 dark:bg-rose-900/20' : 'bg-gray-100 dark:bg-gray-700';
            const trendGradient = isUp ? 'from-emerald-50/50 to-transparent' : isDown ? 'from-rose-50/50 to-transparent' : '';

            return (
                <div 
                    onClick={onClick}
                    draggable={draggable}
                    onDragStart={onDragStart}
                    onDragEnter={onDragEnter}
                    onDragEnd={onDragEnd}
                    className={`group relative overflow-hidden bg-white dark:bg-gray-800 rounded-2xl p-4 mb-3 border shadow-sm transition-all duration-300 hover:-translate-y-1 cursor-pointer ${glowClass}`}
                >
                    {/* Subtle Gradient Background for Trends */}
                    <div className={`absolute inset-0 bg-gradient-to-br ${trendGradient} opacity-0 group-hover:opacity-100 transition-opacity duration-500 dark:opacity-0`}></div>
                    
                    {/* Header Row: Identity & Trend */}
                    <div className="relative flex justify-between items-start mb-4 z-10">
                        <div className="flex items-center gap-3">
                            {draggable && <div className="text-gray-300 dark:text-gray-600 hidden sm:block cursor-grab active:cursor-grabbing hover:text-gray-500"><IconRenderer icon={Icons.Move} /></div>}
                            
                            {/* Icon Box */}
                            <div className="w-12 h-12 rounded-xl bg-gray-50 dark:bg-gray-700/50 border border-gray-100 dark:border-gray-600 flex items-center justify-center text-2xl shadow-sm relative group-hover:scale-105 transition-transform duration-300">
                                {icon}
                                {stats && stats.direction !== 'neutral' && (
                                    <div className={`absolute -top-1 -right-1 w-4 h-4 rounded-full border-2 border-white dark:border-gray-800 flex items-center justify-center text-[8px] font-bold ${isUp ? 'bg-emerald-500 text-white' : 'bg-rose-500 text-white'}`}>
                                        {isUp ? '‚Üë' : '‚Üì'}
                                    </div>
                                )}
                            </div>

                            {/* Name & Code */}
                            <div>
                                <h3 className="font-bold text-gray-800 dark:text-white text-base leading-tight">{title}</h3>
                                <span className="text-xs text-gray-400 font-mono font-medium tracking-wide">{code}</span>
                            </div>
                        </div>

                        {/* Trend Badge */}
                        {stats && (
                            <div className={`px-2.5 py-1 rounded-lg flex items-center gap-1.5 ${trendBgColor} border border-transparent group-hover:border-current transition-colors duration-300 ${trendTextColor}`}>
                                <span className="text-[10px] font-bold num-en">{stats.percent}%</span>
                                <div className="w-3 h-3"><IconRenderer icon={trendIcon} /></div>
                            </div>
                        )}
                    </div>

                    {/* Prices Grid */}
                    <div className="relative z-10 grid grid-cols-2 gap-3">
                        {/* Sell Box */}
                        <div className="flex flex-col p-2.5 rounded-xl bg-gray-50 dark:bg-gray-700/30 border border-gray-100 dark:border-gray-700/50 group-hover:bg-white dark:group-hover:bg-gray-700 transition-colors">
                            <span className="text-[10px] text-gray-400 font-medium mb-1 flex items-center gap-1">
                                <span className="w-1.5 h-1.5 rounded-full bg-red-400"></span> ŸÖÿ®Ÿäÿπ
                            </span>
                            <span className={`text-lg font-black num-en tracking-tight ${isDown ? 'text-rose-500' : 'text-gray-800 dark:text-white'}`}>
                                {parseFloat(sell).toLocaleString('en-US', { maximumFractionDigits: 3 })}
                            </span>
                        </div>

                        {/* Buy Box */}
                        <div className="flex flex-col p-2.5 rounded-xl bg-gray-50 dark:bg-gray-700/30 border border-gray-100 dark:border-gray-700/50 group-hover:bg-white dark:group-hover:bg-gray-700 transition-colors">
                            <span className="text-[10px] text-gray-400 font-medium mb-1 flex items-center gap-1">
                                <span className="w-1.5 h-1.5 rounded-full bg-emerald-400"></span> ÿ¥ÿ±ÿßÿ°
                            </span>
                            <span className={`text-lg font-black num-en tracking-tight ${isUp ? 'text-emerald-500' : 'text-brand-primary'}`}>
                                {parseFloat(buy).toLocaleString('en-US', { maximumFractionDigits: 3 })}
                            </span>
                        </div>
                    </div>
                </div>
            );
        };
        // *** END REDESIGNED RATE CARD ***

        const InstallPrompt = () => {
            const [deferredPrompt, setDeferredPrompt] = useState(null);
            const [showBanner, setShowBanner] = useState(false);
            useEffect(() => {
                const handler = (e) => { e.preventDefault(); setDeferredPrompt(e); setShowBanner(true); };
                window.addEventListener('beforeinstallprompt', handler);
                return () => window.removeEventListener('beforeinstallprompt', handler);
            }, []);
            const handleInstallClick = () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((res) => { setDeferredPrompt(null); setShowBanner(false); });
                }
            };
            if (!showBanner) return null;
            return (
                <div className="fixed top-0 left-0 right-0 z-[60] p-4 install-banner">
                    <div className="bg-brand-dark text-white rounded-2xl shadow-2xl p-4 flex items-center justify-between border border-brand-primary/30">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-brand-primary rounded-xl flex items-center justify-center font-bold text-brand-dark">24</div>
                            <div><h3 className="font-bold text-sm">ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÑŸäÿ±ÿ© 24</h3><p className="text-xs text-brand-light opacity-80">ÿ™ÿ´ÿ®Ÿäÿ™ ŸÑŸÑŸàÿµŸàŸÑ ÿßŸÑÿ≥ÿ±Ÿäÿπ</p></div>
                        </div>
                        <div className="flex items-center gap-2">
                            <button onClick={() => setShowBanner(false)} className="p-2 text-gray-400 hover:text-white"><IconRenderer icon={Icons.X} /></button>
                            <button onClick={handleInstallClick} className="bg-brand-primary text-brand-dark px-4 py-2 rounded-xl text-xs font-bold hover:bg-white transition flex items-center gap-2"><IconRenderer icon={Icons.Download} /> ÿ™ÿ´ÿ®Ÿäÿ™</button>
                        </div>
                    </div>
                </div>
            );
        };

        const SplashScreen = () => (
            <div className="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-brand-dark transition-all duration-500">
                <div className="flex flex-col items-center animate-in fade-in zoom-in duration-700">
                    <div className="w-24 h-24 bg-brand-primary rounded-full flex items-center justify-center text-brand-dark font-bold text-4xl mb-6 shadow-2xl shadow-brand-primary/20 relative">
                        <div className="absolute inset-0 rounded-full border-4 border-white/10 animate-pulse"></div>24
                    </div>
                    <h1 className="text-3xl font-bold text-white mb-2 tracking-wide">ÿßŸÑŸÑŸäÿ±ÿ© 24</h1>
                    <p className="text-brand-light text-sm opacity-90 font-light">ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ∞Ÿáÿ® ŸàÿßŸÑÿπŸÖŸÑÿßÿ™ ŸÑÿ≠ÿ∏ÿ© ÿ®ŸÑÿ≠ÿ∏ÿ©</p>
                </div>
                <div className="absolute bottom-12"><div className="flex gap-1"><div className="w-2 h-2 bg-brand-primary rounded-full animate-bounce" style={{animationDelay: '0s'}}></div><div className="w-2 h-2 bg-brand-primary rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div><div className="w-2 h-2 bg-brand-primary rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div></div></div>
            </div>
        );

        // --- Main App ---
        function App() {
            const [showSplash, setShowSplash] = useState(true);
            const [activeTab, setActiveTab] = useState('home');
            const [currencyData, setCurrencyData] = useState([]);
            const [globalRawData, setGlobalRawData] = useState(null);
            const [baseCurrency, setBaseCurrency] = useState('USD');
            const [convAmount, setConvAmount] = useState(100);
            const [convFrom, setConvFrom] = useState('USD');
            const [convTo, setConvTo] = useState('EUR');
            const [goldData, setGoldData] = useState([]);
            const [loading, setLoading] = useState(true);
            const [globalLoading, setGlobalLoading] = useState(false);
            
            // --- Theme Logic ---
            const getInitialThemePreference = () => localStorage.getItem('themePreference') || 'system';
            const isSystemDark = () => window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            const getEffectiveDarkMode = (pref) => {
                if (pref === 'dark') return true;
                if (pref === 'light') return false;
                return isSystemDark();
            };

            const [themePreference, setThemePreference] = useState(getInitialThemePreference); // system, dark, light
            const [darkMode, setDarkMode] = useState(() => getEffectiveDarkMode(getInitialThemePreference())); // Actual effective mode

            // *** ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÖÿ∏Ÿáÿ± ***
            useEffect(() => { 
                // 1. Save Preference
                localStorage.setItem('themePreference', themePreference);

                // 2. Calculate Effective Theme
                let effectiveDark = getEffectiveDarkMode(themePreference);

                // 3. Apply Class to <html>
                if (effectiveDark) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                
                // 4. Update UI State
                setDarkMode(effectiveDark); 

            }, [themePreference]);
            
            // *** ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ŸÑÿ™ÿ∫ŸäŸäÿ± ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ (ŸÅŸÇÿ∑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿÆŸäÿßÿ± 'ÿ™ŸÑŸÇÿßÿ¶Ÿä') ***
            useEffect(() => {
                const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                const handler = (e) => {
                    if (themePreference === 'system') {
                        const effectiveDark = e.matches;
                        if (effectiveDark) {
                            document.documentElement.classList.add('dark');
                        } else {
                            document.documentElement.classList.remove('dark');
                        }
                        setDarkMode(effectiveDark);
                    }
                };
                mediaQuery.addEventListener('change', handler);
                return () => mediaQuery.removeEventListener('change', handler);
            }, [themePreference]);
            // --- ŸÜŸáÿßŸäÿ© ŸÖŸÜÿ∑ŸÇ ÿßŸÑŸÖÿ∏Ÿáÿ± ---

            const [goldCalcWeight, setGoldCalcWeight] = useState(''); 
            const [goldCalcFee, setGoldCalcFee] = useState('');       
            const [selectedGoldId, setSelectedGoldId] = useState(null);
            const [dbLastUpdate, setDbLastUpdate] = useState(new Date());
            const [apiLastUpdate, setApiLastUpdate] = useState(new Date());
            const [showGold, setShowGold] = useState(() => { return localStorage.getItem('showGoldOnHome') !== 'false'; });
            const [calcAmount, setCalcAmount] = useState(100);
            const [calcSource, setCalcSource] = useState(null);
            const [chartTimeframe, setChartTimeframe] = useState('1D');
            const [chartData, setChartData] = useState([]);

            // State for Settings accordion
            const [isCustomizeOpen, setIsCustomizeOpen] = useState(false);

            // Sort & Drag State - Currency
            const [pinned, setPinned] = useState(() => { try { return JSON.parse(localStorage.getItem('pinnedCurrencies')) || ['USD', 'EUR', 'TRY', 'SAR']; } catch { return ['USD', 'EUR', 'TRY', 'SAR']; } });
            const [selectedCurrency, setSelectedCurrency] = useState(null);
            
            // Sort & Drag State - Gold
            const [goldOrder, setGoldOrder] = useState(() => { try { return JSON.parse(localStorage.getItem('goldOrder')) || []; } catch { return []; } });
            
            // ** NEW: Pinned Gold State **
            const [pinnedGold, setPinnedGold] = useState(() => { try { return JSON.parse(localStorage.getItem('pinnedGold')) || []; } catch { return []; } });

            const [selectedGoldCard, setSelectedGoldCard] = useState(null);

            const dragItem = useRef();
            const dragOverItem = useRef();

            useEffect(() => { setTimeout(() => setShowSplash(false), 3000); }, []);
            useEffect(() => { localStorage.setItem('pinnedCurrencies', JSON.stringify(pinned)); }, [pinned]);
            useEffect(() => { localStorage.setItem('goldOrder', JSON.stringify(goldOrder)); }, [goldOrder]);
            useEffect(() => { localStorage.setItem('showGoldOnHome', showGold); }, [showGold]);
            useEffect(() => { localStorage.setItem('pinnedGold', JSON.stringify(pinnedGold)); }, [pinnedGold]);
            
            useEffect(() => { loadData(); }, []);
            useEffect(() => { if (goldData.length > 0 && !selectedGoldId) setSelectedGoldId(goldData[0].id || goldData[0].description); }, [goldData]);
            
            // Auto-init Pinned Gold
            useEffect(() => {
                if (goldData.length > 0 && pinnedGold.length === 0) {
                     setPinnedGold(goldData.slice(0, 2).map(g => g.description));
                }
            }, [goldData]);

            useEffect(() => {
                if (calcSource) {
                    const base = parseFloat(calcSource.sell_price);
                    let points = 24, volatility = 0.01;
                    if(chartTimeframe==='1W'){points=7;volatility=0.015;}else if(chartTimeframe==='1M'){points=30;volatility=0.03;}else if(chartTimeframe==='1Y'){points=12;volatility=0.10;}
                    setChartData(generateChartData(base, points, volatility));
                }
            }, [calcSource, chartTimeframe]);
            useEffect(() => { if (activeTab === 'global') fetchGlobalRates(); }, [activeTab]);
            
            const loadData = async () => {
                setLoading(true);
                const [currencies, gold] = await Promise.all([fetchSupabaseData("currency_rates_api"), fetchSupabaseData("gold_rates_api")]);
                const enrichedCurrencies = currencies.map(c => {
                    const { code } = getFlagAndCode(c.name);
                    const stats = calculateChange(c.sell_price, c.previous_sell_price);
                    return { ...c, stats, code };
                });
                const enrichedGold = gold.map(g => {
                    const stats = calculateChange(g.sell_price, g.previous_sell_price);
                    return { ...g, stats };
                });
                setDbLastUpdate(new Date());
                setCurrencyData(enrichedCurrencies);
                setGoldData(enrichedGold);
                if (goldOrder.length === 0 && enrichedGold.length > 0) {
                    setGoldOrder(enrichedGold.map(g => g.description));
                }
                const usd = enrichedCurrencies.find(c => c.name.includes("ÿØŸàŸÑÿßÿ±"));
                if (usd) setCalcSource(usd);
                setLoading(false);
                if (window.lucide) setTimeout(() => window.lucide.createIcons(), 100);
            };

            const fetchGlobalRates = async () => {
                const now = Date.now();
                const cachedGlobal = localStorage.getItem('globalRatesRaw');
                const lastGlobalFetch = localStorage.getItem('globalRatesTime');
                if (cachedGlobal && lastGlobalFetch && (now - parseInt(lastGlobalFetch) < GLOBAL_CACHE_DURATION)) {
                    setGlobalRawData(JSON.parse(cachedGlobal));
                    return;
                }
                setGlobalLoading(true);
                try {
                    const res = await fetch(`https://api.currencyapi.com/v3/latest?apikey=${CURRENCY_API_KEY}&base_currency=USD`);
                    const result = await res.json();
                    if (result.data) {
                        setGlobalRawData(result.data);
                        localStorage.setItem('globalRatesRaw', JSON.stringify(result.data));
                        localStorage.setItem('globalRatesTime', now.toString());
                        setApiLastUpdate(new Date());
                    }
                } catch (error) { console.error("Error global rates", error); }
                setGlobalLoading(false);
            };

            const handleSort = () => {
                let _pinned = [...pinned];
                const draggedItemContent = _pinned.splice(dragItem.current, 1)[0];
                _pinned.splice(dragOverItem.current, 0, draggedItemContent);
                dragItem.current = null;
                dragOverItem.current = null;
                setPinned(_pinned);
            };
            const handleMoveCard = (code, direction) => {
                const idx = pinned.indexOf(code);
                if (idx === -1) return;
                const newIdx = idx + direction;
                if (newIdx < 0 || newIdx >= pinned.length) return;
                const newPinned = [...pinned];
                [newPinned[idx], newPinned[newIdx]] = [newPinned[newIdx], newPinned[idx]];
                setPinned(newPinned);
            };

            const handleGoldSort = () => {
                let _order = [...goldOrder];
                const draggedItemContent = _order.splice(dragItem.current, 1)[0];
                _order.splice(dragOverItem.current, 0, draggedItemContent);
                dragItem.current = null;
                dragOverItem.current = null;
                setGoldOrder(_order);
            };
            const handleMoveGold = (desc, direction) => {
                const idx = goldOrder.indexOf(desc);
                if (idx === -1) return;
                const newIdx = idx + direction;
                if (newIdx < 0 || newIdx >= goldOrder.length) return;
                const newOrder = [...goldOrder];
                [newOrder[idx], newOrder[newIdx]] = [newOrder[newIdx], newOrder[idx]];
                setGoldOrder(newOrder);
            };

            // *** REDESIGNED HEADER START ***
            const Header = ({ title, subtitle, time }) => (
                <div className="relative z-10 mb-[-2rem] overflow-hidden rounded-b-[3rem] bg-[#163300] shadow-2xl">
                    {/* Background Effects */}
                    <div className="absolute inset-0 bg-gradient-to-br from-[#1a3c00] via-[#112700] to-[#0a1a00]"></div>
                    <div className="absolute -top-24 -right-24 w-64 h-64 bg-[#2ed06e] opacity-10 rounded-full blur-3xl"></div>
                    <div className="absolute -bottom-24 -left-24 w-64 h-64 bg-[#9fe870] opacity-10 rounded-full blur-3xl"></div>

                    <div className="relative p-6 pb-12 pt-8">
                        {/* Top Bar */}
                        <div className="flex justify-between items-center mb-8">
                            {/* Brand */}
                            <div className="flex items-center gap-3">
                                <div className="relative w-10 h-10 flex items-center justify-center">
                                    <div className="absolute inset-0 bg-gradient-to-tr from-[#2ed06e] to-[#9fe870] rounded-xl rotate-6 opacity-80"></div>
                                    <div className="absolute inset-0 bg-[#163300] rounded-xl border border-[#2ed06e]/30 flex items-center justify-center text-[#2ed06e] font-black text-sm z-10 shadow-lg">24</div>
                                </div>
                                <div className="flex flex-col">
                                    <h1 className="text-lg font-bold text-white leading-none tracking-wide">ÿßŸÑŸÑŸäÿ±ÿ© 24</h1>
                                    <span className="text-[10px] text-[#9fe870] font-light tracking-widest opacity-80">SYRIAN POUND</span>
                                </div>
                            </div>

                            {/* Actions */}
                            <div className="flex items-center gap-2">
                                <button
                                    onClick={() => setActiveTab('settings')}
                                    className="w-10 h-10 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-white/70 hover:bg-white/10 hover:text-white hover:border-white/20 transition-all active:scale-95"
                                >
                                    <IconRenderer icon={Icons.Settings} />
                                </button>
                                <button
                                    onClick={loadData}
                                    className="group w-10 h-10 rounded-full bg-gradient-to-br from-[#2ed06e] to-[#25a556] shadow-lg shadow-[#2ed06e]/20 flex items-center justify-center text-[#0f2400] transition-all active:scale-95 hover:shadow-[#2ed06e]/40"
                                >
                                    <div className="group-active:rotate-180 transition-transform duration-500">
                                        <IconRenderer icon={Icons.Refresh} />
                                    </div>
                                </button>
                            </div>
                        </div>

                        {/* Main Content */}
                        <div>
                            <h2 className="text-3xl font-black text-white mb-2 leading-tight tracking-tight">{title}</h2>
                            <div className="flex flex-wrap items-center gap-3">
                                <div className="flex items-center gap-2 bg-white/5 border border-white/10 px-3 py-1 rounded-full backdrop-blur-sm">
                                    <span className="w-1.5 h-1.5 bg-[#2ed06e] rounded-full animate-pulse"></span>
                                    <span className="text-xs text-[#9fe870] font-mono num-en">{formatLastUpdate(time)}</span>
                                </div>
                                <span className="text-sm text-gray-400 font-light border-l border-white/10 pl-3">{subtitle}</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
            // *** REDESIGNED HEADER END ***

            const renderHome = () => {
                const visibleCurrencies = pinned.map(code => currencyData.find(c => c.code === code)).filter(Boolean);
                // ** UPDATED: Use pinnedGold state instead of just slicing the top 2 **
                const visibleGold = pinnedGold.map(desc => goldData.find(g => g.description === desc)).filter(Boolean);
                
                return (
                    <div className="pb-24">
                        <Header title="ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿµÿ±ŸÅ" subtitle="ŸÖÿ®ÿßÿ¥ÿ± ŸÖŸÇÿßÿ®ŸÑ ÿßŸÑŸÑŸäÿ±ÿ© ÿßŸÑÿ≥Ÿàÿ±Ÿäÿ©" time={dbLastUpdate} />
                        <div className="px-4 pt-12">
                            {loading ? <div className="text-center py-10 text-gray-400">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</div> : (
                                <>
                                    <div className="flex justify-between items-center mb-2 px-1"><span className="font-bold text-gray-700 dark:text-gray-200">ÿßŸÑÿπŸÖŸÑÿßÿ™ ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©</span><span className="text-xs text-brand-primary bg-brand-primary/10 px-2 py-1 rounded-full flex items-center gap-1"><span className="w-1.5 h-1.5 rounded-full bg-brand-primary animate-pulse"></span>ŸÖÿ®ÿßÿ¥ÿ±</span></div>
                                    {visibleCurrencies.length > 0 ? visibleCurrencies.map((c, i) => { 
                                        const { flag } = getFlagAndCode(c.name); 
                                        return <RateCard key={c.code} title={c.name} buy={c.buy_price} sell={c.sell_price} icon={flag} code={c.code} stats={c.stats} onClick={() => setSelectedCurrency(c)} draggable={true} onDragStart={() => (dragItem.current = i)} onDragEnter={() => (dragOverItem.current = i)} onDragEnd={handleSort} />; 
                                    }) : <div className="text-center py-8 text-gray-400 text-sm">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿπŸÖŸÑÿßÿ™ ŸÖÿ´ÿ®ÿ™ÿ©.</div>}
                                    
                                    {showGold && (
                                        <>
                                            <div className="flex justify-between items-center mb-2 px-1 mt-6"><span className="font-bold text-gray-700 dark:text-gray-200">ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ∞Ÿáÿ® (ŸÖÿÆÿ™ÿµÿ±)</span></div>
                                            {visibleGold.length > 0 ? visibleGold.map((g, i) => (
                                                <RateCard key={`g-${i}`} title={g.description} buy={g.buy_price} sell={g.sell_price} icon="üèÜ" code="GOLD" stats={g.stats} onClick={() => setSelectedGoldCard(g)} />
                                            )) : <div className="text-center py-4 text-xs text-gray-400">ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ´ÿ®Ÿäÿ™ ÿ£Ÿä ÿπŸäÿßÿ±ÿßÿ™ ÿ∞Ÿáÿ® ŸÑŸÑÿπÿ±ÿ∂.</div>}
                                        </>
                                    )}
                                </>
                            )}
                        </div>
                        {selectedCurrency && <CurrencyDetailModal currency={selectedCurrency} onClose={() => setSelectedCurrency(null)} onMove={handleMoveCard} time={dbLastUpdate} />}
                        {selectedGoldCard && <GoldDetailModal gold={selectedGoldCard} onClose={() => setSelectedGoldCard(null)} onMove={handleMoveGold} time={dbLastUpdate} />}
                    </div>
                );
            };

            const renderGold = () => {
                const activeGold = goldData.find(g => (g.id || g.description) === selectedGoldId) || goldData[0];
                const weight = parseFloat(goldCalcWeight) || 0;
                const fee = parseFloat(goldCalcFee) || 0;
                const goldPrice = activeGold ? parseFloat(activeGold.sell_price) : 0;
                const rawTotal = weight * goldPrice;
                const feeTotal = weight * fee;
                const finalTotal = rawTotal + feeTotal;
                
                const sortedGoldData = goldOrder.map(desc => goldData.find(g => g.description === desc)).filter(Boolean);
                const unsortedGold = goldData.filter(g => !goldOrder.includes(g.description));
                const finalDisplayGold = [...sortedGoldData, ...unsortedGold];

                return (
                    <div className="pb-24">
                        <Header title="ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ∞Ÿáÿ®" subtitle="ÿ™ÿ≠ÿØŸäÿ´ ŸÑÿ≠ÿ∏Ÿä ŸÖŸÜ ÿßŸÑÿµÿßÿ∫ÿ©" time={dbLastUpdate} />
                        <div className="px-4 pt-12">
                            {loading ? <div className="text-center py-10">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</div> : (
                                <>
                                    <div className="mb-8 space-y-3">
                                         {finalDisplayGold.map((g, i) => (
                                            <RateCard 
                                                key={i} 
                                                title={g.description} 
                                                buy={g.buy_price} 
                                                sell={g.sell_price} 
                                                icon="‚ú®" 
                                                code={`K${24-i}`} 
                                                stats={g.stats} 
                                                onClick={() => setSelectedGoldCard(g)}
                                                draggable={true} 
                                                onDragStart={() => (dragItem.current = i)} 
                                                onDragEnter={() => (dragOverItem.current = i)} 
                                                onDragEnd={handleGoldSort}
                                            />
                                        ))}
                                    </div>
                                    <div className="bg-white dark:bg-gray-800 rounded-[2rem] shadow-xl border border-gray-100 dark:border-gray-700 overflow-hidden relative animate-in fade-in slide-in-from-bottom-4 duration-700">
                                        <div className="bg-brand-dark p-5 relative overflow-hidden">
                                            <div className="absolute top-0 right-0 w-32 h-32 bg-brand-primary/10 rounded-full blur-2xl translate-x-10 -translate-y-10"></div>
                                            <h3 className="text-white font-bold text-lg flex items-center gap-2 relative z-10">
                                                <div className="p-1.5 bg-brand-primary rounded-lg text-brand-dark"><IconRenderer icon={Icons.Calculator} /></div>ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑÿ∞Ÿáÿ® ŸàÿßŸÑŸÖÿµŸÜÿπŸäÿ©
                                            </h3>
                                            <p className="text-brand-light/80 text-xs mt-1 mr-10 relative z-10">ÿ≠ÿ≥ÿßÿ® ÿØŸÇŸäŸÇ Ÿäÿ¥ŸÖŸÑ ÿßŸÑŸàÿ≤ŸÜ Ÿàÿ£ÿ¨ÿ±ÿ© ÿßŸÑÿµŸäÿßÿ∫ÿ©</p>
                                        </div>
                                        <div className="p-5">
                                            <div className="mb-4">
                                                <label className="text-xs font-bold text-gray-500 mb-2 block px-1">ÿπŸäÿßÿ± ÿßŸÑÿ∞Ÿáÿ®</label>
                                                <div className="flex gap-2 overflow-x-auto no-scrollbar pb-2">
                                                    {goldData.map((g, i) => {
                                                        const isActive = (g.id || g.description) === (activeGold?.id || activeGold?.description);
                                                        return (
                                                            <button key={i} onClick={() => setSelectedGoldId(g.id || g.description)} className={`flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold transition-all duration-300 border ${isActive ? 'bg-brand-primary text-brand-dark border-brand-primary shadow-lg shadow-brand-primary/30' : 'bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600'}`}>{g.description}</button>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-2 gap-4 mb-6">
                                                <div className="bg-gray-50 dark:bg-gray-900/50 rounded-2xl p-3 border border-gray-100 dark:border-gray-700 focus-within:border-brand-primary focus-within:ring-1 focus-within:ring-brand-primary transition-all">
                                                    <label className="text-[10px] text-gray-400 block mb-1">ÿßŸÑŸàÿ≤ŸÜ (ÿ∫ÿ±ÿßŸÖ)</label>
                                                    <div className="flex items-center justify-between"><input type="number" value={goldCalcWeight} onChange={(e) => setGoldCalcWeight(e.target.value)} placeholder="0" className="w-full bg-transparent font-bold text-xl text-brand-dark dark:text-white outline-none num-en placeholder-gray-300" /><span className="text-xs font-bold text-gray-400 bg-white dark:bg-gray-700 px-2 py-1 rounded-md shadow-sm">gm</span></div>
                                                </div>
                                                <div className="bg-gray-50 dark:bg-gray-900/50 rounded-2xl p-3 border border-gray-100 dark:border-gray-700 focus-within:border-brand-primary focus-within:ring-1 focus-within:ring-brand-primary transition-all">
                                                    <label className="text-[10px] text-gray-400 block mb-1">ÿßŸÑŸÖÿµŸÜÿπŸäÿ© (ŸÑŸÑÿ∫ÿ±ÿßŸÖ)</label>
                                                    <div className="flex items-center justify-between"><input type="number" value={goldCalcFee} onChange={(e) => setGoldCalcFee(e.target.value)} placeholder="0" className="w-full bg-transparent font-bold text-xl text-brand-dark dark:text-white outline-none num-en placeholder-gray-300" /><span className="text-xs font-bold text-gray-400 bg-white dark:bg-gray-700 px-2 py-1 rounded-md shadow-sm">ŸÑ.ÿ≥</span></div>
                                                </div>
                                            </div>
                                            <div className="bg-gradient-to-br from-brand-bg to-white dark:from-gray-700 dark:to-gray-800 rounded-2xl p-4 border border-dashed border-brand-primary/30 relative">
                                                <div className="flex justify-between items-end mb-2"><span className="text-xs text-gray-500 dark:text-gray-400">ÿ≥ÿπÿ± ÿßŸÑÿ∞Ÿáÿ® ÿßŸÑÿÆÿßŸÖ</span><span className="font-mono text-sm text-gray-700 dark:text-gray-300 num-en">{rawTotal.toLocaleString('en-US')}</span></div>
                                                {fee > 0 && (<div className="flex justify-between items-end mb-3 pb-3 border-b border-gray-200 dark:border-gray-600"><span className="text-xs text-gray-500 dark:text-gray-400">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿµŸÜÿπŸäÿ©</span><span className="font-mono text-sm text-gray-700 dark:text-gray-300 num-en">{feeTotal.toLocaleString('en-US')}</span></div>)}
                                                <div className="flex justify-between items-center pt-1">
                                                    <div><p className="text-xs font-bold text-brand-dark dark:text-brand-light mb-0.5">ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ™ŸÇÿØŸäÿ±Ÿä</p><p className="text-[10px] text-gray-400">ŸäÿÆÿ™ŸÑŸÅ ÿßŸÑÿ≥ÿπÿ± ŸÇŸÑŸäŸÑÿßŸã ÿ®ŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑÿßÿ™</p></div>
                                                    <div className="text-right"><span className="block text-2xl font-black text-brand-primary num-en tracking-tight">{finalTotal > 0 ? finalTotal.toLocaleString('en-US') : '0'}</span><span className="text-[10px] font-bold text-gray-400 uppercase">ŸÑŸäÿ±ÿ© ÿ≥Ÿàÿ±Ÿäÿ©</span></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </>
                            )}
                        </div>
                        {selectedGoldCard && <GoldDetailModal gold={selectedGoldCard} onClose={() => setSelectedGoldCard(null)} onMove={handleMoveGold} time={dbLastUpdate} />}
                    </div>
                );
            };

            const renderGlobal = () => {
                let convResult = 0;
                if (globalRawData) {
                    const fromRate = convFrom === 'USD' ? 1 : globalRawData[convFrom]?.value || 1;
                    const toRate = convTo === 'USD' ? 1 : globalRawData[convTo]?.value || 1;
                    convResult = (convAmount / fromRate) * toRate;
                }
                let displayList = [];
                if (globalRawData) {
                    let conversionFactor = 1;
                    if (baseCurrency === 'EUR') {
                        const eurRate = globalRawData['EUR']?.value;
                        if (eurRate) conversionFactor = 1 / eurRate;
                    }
                    Object.keys(GLOBAL_DISPLAY_MAP).forEach(key => {
                        if (key === baseCurrency) return;
                        if (globalRawData[key]) {
                            const rawRate = globalRawData[key].value;
                            const baseRate = rawRate * conversionFactor;
                            const sell = baseRate * (1 + SPREAD_PERCENTAGE);
                            const buy = baseRate * (1 - SPREAD_PERCENTAGE);
                            displayList.push({ code: key, buy: buy, sell: sell, ...GLOBAL_DISPLAY_MAP[key] });
                        }
                    });
                }
                return (
                    <div className="pb-24">
                        <Header title="ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿπÿßŸÑŸÖŸäÿ©" subtitle="ÿ™ÿ≠ŸàŸäŸÑ Ÿàÿ≠ÿßÿ≥ÿ®ÿ© ŸÅŸàÿ±Ÿäÿ©" time={apiLastUpdate} />
                        <div className="px-4 pt-12">
                            <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-100 dark:border-gray-700 p-5 mb-8 relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-full h-1 bg-brand-primary"></div>
                                <h3 className="text-sm font-bold text-gray-500 mb-4 flex items-center gap-2"><IconRenderer icon={Icons.Calculator} />ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑÿπŸÖŸÑÿßÿ™ ÿßŸÑÿπÿßŸÑŸÖŸäÿ©</h3>
                                <div className="flex gap-3 mb-4">
                                    <div className="flex-1"><label className="text-[10px] text-gray-400 mb-1 block">ÿßŸÑŸÖÿ®ŸÑÿ∫</label><input type="number" value={convAmount} onChange={(e) => setConvAmount(e.target.value)} className="w-full bg-gray-50 dark:bg-gray-700 rounded-lg p-3 font-bold text-lg outline-none border focus:border-brand-primary dark:text-white num-en" /></div>
                                </div>
                                <div className="flex items-center gap-2 mb-4">
                                    <div className="flex-1"><label className="text-[10px] text-gray-400 mb-1 block">ŸÖŸÜ</label><select value={convFrom} onChange={(e) => setConvFrom(e.target.value)} className="w-full bg-gray-50 dark:bg-gray-700 rounded-lg p-2 text-sm font-bold outline-none dark:text-white"><option value="USD">üá∫üá∏ USD</option>{Object.keys(GLOBAL_DISPLAY_MAP).map(k => <option key={k} value={k}>{GLOBAL_DISPLAY_MAP[k].flag} {k}</option>)}</select></div>
                                    <button onClick={() => { const temp = convFrom; setConvFrom(convTo); setConvTo(temp); }} className="mt-4 w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-600 flex items-center justify-center text-gray-500 hover:bg-brand-primary hover:text-white transition"><div className="rotate-90"><IconRenderer icon={Icons.ArrowDownUp} /></div></button>
                                    <div className="flex-1"><label className="text-[10px] text-gray-400 mb-1 block">ÿ•ŸÑŸâ</label><select value={convTo} onChange={(e) => setConvTo(e.target.value)} className="w-full bg-gray-50 dark:bg-gray-700 rounded-lg p-2 text-sm font-bold outline-none dark:text-white"><option value="USD">üá∫üá∏ USD</option>{Object.keys(GLOBAL_DISPLAY_MAP).map(k => <option key={k} value={k}>{GLOBAL_DISPLAY_MAP[k].flag} {k}</option>)}</select></div>
                                </div>
                                <div className="bg-brand-bg dark:bg-gray-900/50 rounded-xl p-3 flex flex-col items-center justify-center border border-dashed border-gray-300 dark:border-gray-600"><span className="text-xs text-gray-400">ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑÿ™ŸÇÿØŸäÿ±Ÿäÿ©</span><div className="text-2xl font-bold text-brand-dark dark:text-brand-primary num-en mt-1">{convResult.toLocaleString('en-US', { maximumFractionDigits: 2 })} <span className="text-xs ml-1 text-gray-500">{convTo}</span></div></div>
                            </div>
                            <div className="flex items-center justify-between mb-4">
                                <h3 className="font-bold text-gray-700 dark:text-gray-200">ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ£ÿ≥ÿπÿßÿ±</h3>
                                <div className="flex bg-gray-200 dark:bg-gray-700 rounded-lg p-0.5">
                                    <button onClick={() => setBaseCurrency('USD')} className={`px-3 py-1 rounded-md text-xs font-bold transition ${baseCurrency === 'USD' ? 'bg-white dark:bg-gray-600 shadow text-brand-dark dark:text-white' : 'text-gray-500'}`}>USD ($)</button>
                                    <button onClick={() => setBaseCurrency('EUR')} className={`px-3 py-1 rounded-md text-xs font-bold transition ${baseCurrency === 'EUR' ? 'bg-white dark:bg-gray-600 shadow text-brand-dark dark:text-white' : 'text-gray-500'}`}>EUR (‚Ç¨)</button>
                                </div>
                            </div>
                            {globalLoading && !globalRawData ? <div className="text-center py-10 text-gray-400">ÿ¨ÿßÿ±Ÿä ÿ¨ŸÑÿ® ÿßŸÑÿ£ÿ≥ÿπÿßÿ±...</div> : (
                                <>
                                    {displayList.map((curr, i) => <RateCard key={i} title={curr.name} buy={curr.buy} sell={curr.sell} icon={curr.flag} code={curr.code} />)}
                                    <p className="text-center text-xs text-gray-400 mt-4">ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ÿπÿßŸÑŸÖŸäÿ© ŸàŸäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´Ÿáÿß ŸÉŸÑ 45 ÿØŸÇŸäŸÇÿ©.</p>
                                </>
                            )}
                        </div>
                    </div>
                );
            };

            const renderCalculator = () => {
                const isTrendUp = chartData.length > 0 && chartData[chartData.length - 1] > chartData[0];
                const chartColor = isTrendUp ? "#2ed06e" : "#ef4444";
                return (
                    <div className="pb-24">
                        <Header title="ÿßŸÑÿ≠ÿßÿ≥ÿ®ÿ© ŸàÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ" subtitle="ÿ≠ÿ≥ÿßÿ® ÿØŸÇŸäŸÇ ŸÑŸÉÿßŸÅÿ© ÿßŸÑÿπŸÖŸÑÿßÿ™" time={dbLastUpdate} />
                        <div className="px-4 pt-12">
                            <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-6 border border-gray-100 dark:border-gray-700 mb-4">
                                <label className="block text-sm text-gray-500 mb-2 font-semibold">ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿ±ÿßÿØ ÿ™ÿ≠ŸàŸäŸÑŸá</label>
                                <div className="relative mb-6"><input type="number" value={calcAmount} onChange={(e) => setCalcAmount(e.target.value)} className="w-full text-3xl font-bold text-brand-dark dark:text-white bg-transparent border-b-2 border-gray-200 focus:border-brand-primary outline-none py-2 num-en" /></div>
                                <label className="block text-sm text-gray-500 mb-2 font-semibold">ÿßÿÆÿ™ÿ± ÿßŸÑÿπŸÖŸÑÿ©</label>
                                <div className="grid grid-cols-2 gap-2 mb-4 max-h-40 overflow-y-auto no-scrollbar">
                                    {currencyData.map((c, i) => { const { flag, code } = getFlagAndCode(c.name); const isSelected = calcSource?.name === c.name; return <button key={i} onClick={() => setCalcSource(c)} className={`flex items-center gap-2 p-2 rounded-lg border transition ${isSelected ? 'border-brand-primary bg-brand-primary/10' : 'border-gray-200 dark:border-gray-700'}`}><span>{flag}</span><span className="text-sm font-bold dark:text-gray-200">{code}</span></button>; })}
                                </div>
                                {calcSource && <div className="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4 text-center"><p className="text-gray-500 text-sm mb-1">ÿßŸÑŸÇŸäŸÖÿ© ÿ®ÿßŸÑŸÑŸäÿ±ÿ© ÿßŸÑÿ≥Ÿàÿ±Ÿäÿ©</p><div className="text-3xl font-bold text-brand-primary num-en">{Math.floor(calcAmount * calcSource.sell_price).toLocaleString('en-US')} <span className="text-sm mr-1 text-gray-400">ŸÑ.ÿ≥</span></div></div>}
                            </div>
                            {calcSource && (
                                <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
                                    <div className="p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
                                        <div className="flex items-center gap-2"><div className={`p-1.5 rounded-lg ${isTrendUp ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}`}><IconRenderer icon={isTrendUp ? Icons.TrendUp : Icons.TrendDown} /></div><div><h3 className="font-bold text-sm dark:text-white">ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ≥ÿπÿ±</h3><p className="text-[10px] text-gray-400">{calcSource.name}</p></div></div>
                                        <div className="flex bg-gray-100 dark:bg-gray-700 rounded-lg p-0.5">{['1D', '1W', '1M', '1Y'].map(tf => <button key={tf} onClick={() => setChartTimeframe(tf)} className={`px-3 py-1 text-xs font-bold rounded-md transition ${chartTimeframe === tf ? 'bg-white dark:bg-gray-600 shadow text-brand-primary' : 'text-gray-400 hover:text-gray-600'}`}>{tf === '1D' ? 'ŸäŸàŸÖ' : tf === '1W' ? 'ÿ£ÿ≥ÿ®Ÿàÿπ' : tf === '1M' ? 'ÿ¥Ÿáÿ±' : 'ÿ≥ŸÜÿ©'}</button>)}</div>
                                    </div>
                                    <div className="p-4 relative"><LineChart data={chartData} color={chartColor} /></div>
                                    <div className="bg-gray-50 dark:bg-gray-700/30 p-3 flex justify-between text-xs text-gray-500 dark:text-gray-400 px-6">
                                        <div className="flex items-center gap-1"><IconRenderer icon={Icons.Target} /><span>ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿßŸÅÿ™ÿ™ÿßÿ≠: <span className="font-bold num-en">{chartData[0]?.toLocaleString('en-US', {maximumFractionDigits:0})}</span></span></div>
                                        <div className="flex items-center gap-1"><IconRenderer icon={Icons.Clock} /><span>ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ: <span className="font-bold num-en">{chartData[chartData.length-1]?.toLocaleString('en-US', {maximumFractionDigits:0})}</span></span></div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // --- Updated Settings Renderer ---
            const renderSettings = () => (
                <div className="pb-24">
                    <Header title="ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™" subtitle="ÿ™ÿÆÿµŸäÿµ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ" time={dbLastUpdate} />
                    <div className="px-4 pt-12 space-y-4">
                        
                        {/* *** ÿßŸÑÿ™ÿπÿØŸäŸÑ 3: ÿ®ÿ∑ÿßŸÇÿ© ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿ∏Ÿáÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ© (ÿ™ŸÑŸÇÿßÿ¶Ÿä ÿ£Ÿà ŸäÿØŸàŸä) *** */}
                        <div className="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-gray-700">
                            <div className="flex items-center gap-3 mb-4">
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center bg-gray-100 dark:bg-gray-700 text-gray-500`}>
                                    <IconRenderer icon={Icons.Moon} />
                                </div>
                                <div>
                                    <h3 className="font-bold text-gray-800 dark:text-white text-sm">ÿßŸÑŸÖÿ∏Ÿáÿ± (ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä)</h3>
                                    <p className="text-[10px] text-gray-400">ÿßÿÆÿ™ÿ± ÿ∑ÿ±ŸäŸÇÿ© ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖÿ∏Ÿáÿ± ÿßŸÑÿØÿßŸÉŸÜ</p>
                                </div>
                            </div>
                            <div className="flex bg-gray-100 dark:bg-gray-700 rounded-xl p-1.5">
                                {['system', 'light', 'dark'].map((mode) => (
                                    <button
                                        key={mode}
                                        onClick={() => setThemePreference(mode)}
                                        className={`flex-1 py-2 rounded-lg text-xs font-bold transition-all flex items-center justify-center gap-2 ${
                                            themePreference === mode 
                                                ? 'bg-white dark:bg-gray-800 shadow-md text-brand-dark dark:text-brand-primary' 
                                                : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200'
                                        }`}
                                    >
                                        <IconRenderer icon={mode === 'system' ? Icons.Globe : mode === 'dark' ? Icons.Moon : Icons.Sun} />
                                        <span>{mode === 'system' ? 'ÿ™ŸÑŸÇÿßÿ¶Ÿä (ÿßŸÑŸÜÿ∏ÿßŸÖ)' : mode === 'dark' ? 'ŸÖÿ∏ŸÑŸÖ' : 'ŸÅÿßÿ™ÿ≠'}</span>
                                    </button>
                                ))}
                            </div>
                            {themePreference === 'system' && (
                                <div className="mt-3 text-center text-[10px] text-gray-500 dark:text-gray-400">
                                    <span className="font-bold">{darkMode ? 'ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©: ŸÖÿ∏ŸÑŸÖ' : 'ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©: ŸÅÿßÿ™ÿ≠'}</span> - Ÿäÿ™ÿ®ÿπ ÿ•ÿπÿØÿßÿØ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ
                                </div>
                            )}
                        </div>
                        {/* *** ŸÜŸáÿßŸäÿ© ÿ®ÿ∑ÿßŸÇÿ© ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿ∏Ÿáÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ© *** */}

                        {/* Redesigned Content Customization (Accordion) */}
                        <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden transition-all duration-300">
                            <button 
                                onClick={() => setIsCustomizeOpen(!isCustomizeOpen)}
                                className="w-full p-4 flex items-center justify-between bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"
                            >
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 rounded-full bg-brand-primary/10 flex items-center justify-center text-brand-primary">
                                        <IconRenderer icon={Icons.Settings} />
                                    </div>
                                    <div className="text-right">
                                        <h3 className="font-bold text-gray-800 dark:text-white text-sm">ÿ™ÿÆÿµŸäÿµ ÿßŸÑŸàÿßÿ¨Ÿáÿ©</h3>
                                        <p className="text-[10px] text-gray-400">ÿßŸÑÿπŸÖŸÑÿßÿ™ ÿßŸÑŸÖÿ´ÿ®ÿ™ÿ© Ÿàÿπÿ±ÿ∂ ÿßŸÑÿ∞Ÿáÿ®</p>
                                    </div>
                                </div>
                                <div className={`transition-transform duration-300 text-gray-400 ${isCustomizeOpen ? 'rotate-180' : ''}`}>
                                     <IconRenderer icon={Icons.ArrowDown} />
                                </div>
                            </button>

                            <div className={`transition-all duration-500 ease-in-out overflow-hidden ${isCustomizeOpen ? 'max-h-[800px] opacity-100' : 'max-h-0 opacity-0'}`}>
                                <div className="p-5 pt-2 bg-gray-50/80 dark:bg-gray-900/30 border-t border-gray-100 dark:border-gray-700">
                                    
                                    {/* Enhanced Gold Section */}
                                    <div className="bg-white dark:bg-gray-800 rounded-xl border border-yellow-100 dark:border-yellow-900/30 overflow-hidden mb-4 shadow-sm">
                                        <div 
                                            onClick={() => setShowGold(!showGold)}
                                            className="p-3 flex items-center justify-between cursor-pointer bg-gradient-to-r from-yellow-50/50 to-transparent dark:from-yellow-900/10 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 transition-colors"
                                        >
                                            <div className="flex items-center gap-3">
                                                <div className="w-8 h-8 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center text-xl shadow-sm border border-yellow-200">üèÜ</div>
                                                <div>
                                                    <h3 className="font-bold text-gray-800 dark:text-gray-100 text-xs">ÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑÿ∞Ÿáÿ®</h3>
                                                    <p className="text-[9px] text-gray-500 dark:text-gray-400">ÿπÿ±ÿ∂ ŸÅŸä ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</p>
                                                </div>
                                            </div>
                                            <div className={`w-10 h-5 rounded-full transition-colors flex items-center px-0.5 ${showGold ? 'bg-yellow-500 justify-end' : 'bg-gray-200 justify-start'}`}>
                                                <div className="w-4 h-4 bg-white rounded-full shadow-sm"></div>
                                            </div>
                                        </div>

                                        <div className={`transition-all duration-300 ease-in-out ${showGold ? 'max-h-96 opacity-100' : 'max-h-0 opacity-0'}`}>
                                            <div className="p-3 pt-0 border-t border-yellow-50 dark:border-yellow-900/20">
                                                <div className="flex justify-between items-center my-2">
                                                     <span className="text-[10px] font-bold text-gray-500 dark:text-gray-400">ÿßŸÑÿπŸäÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿÆÿ™ÿßÿ±ÿ©</span>
                                                     <span className="text-[9px] bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full font-bold">{pinnedGold.length}</span>
                                                </div>
                                                <div className="grid grid-cols-3 gap-2">
                                                    {goldData.map((g, i) => {
                                                        const isSelected = pinnedGold.includes(g.description);
                                                        return (
                                                             <button 
                                                                key={i} 
                                                                onClick={() => { 
                                                                    if(isSelected) setPinnedGold(pinnedGold.filter(p => p !== g.description)); 
                                                                    else setPinnedGold([...pinnedGold, g.description]); 
                                                                }} 
                                                                className={`py-2 px-1 rounded-lg text-[10px] font-bold border transition-all ${
                                                                    isSelected 
                                                                    ? 'bg-yellow-500 text-white border-yellow-600 shadow-md shadow-yellow-500/20 scale-[1.02]' 
                                                                    : 'bg-gray-50 dark:bg-gray-700 text-gray-500 dark:text-gray-400 border-gray-100 dark:border-gray-600 hover:bg-gray-100'
                                                                }`}
                                                            >
                                                                {g.description}
                                                            </button>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Currencies Grid Section */}
                                    <div className="mt-5">
                                        <div className="flex justify-between items-center mb-3 px-1">
                                            <h4 className="text-xs font-bold text-gray-500 dark:text-gray-400">ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿπŸÖŸÑÿßÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</h4>
                                            <span className="text-[10px] text-brand-primary bg-brand-primary/10 px-2 py-0.5 rounded-md">ÿßÿÆÿ™ÿ± ŸÖÿß ŸäŸáŸÖŸÉ</span>
                                        </div>
                                        
                                        <div className="grid grid-cols-2 gap-2">
                                            {currencyData.map((c, i) => { 
                                                const { flag, code } = getFlagAndCode(c.name); 
                                                const isPinned = pinned.includes(code); 
                                                return (
                                                    <div 
                                                        key={i} 
                                                        onClick={() => { if(isPinned) setPinned(pinned.filter(p=>p!==code)); else setPinned([...pinned,code]); }} 
                                                        className={`p-2.5 rounded-xl border cursor-pointer flex items-center gap-2 transition-all duration-200 relative overflow-hidden ${
                                                            isPinned 
                                                            ? 'bg-white dark:bg-gray-700 border-brand-primary shadow-sm' 
                                                            : 'bg-white dark:bg-gray-800 border-transparent hover:border-gray-200 dark:hover:border-gray-600 opacity-60 hover:opacity-100'
                                                        }`}
                                                    >
                                                        <span className="text-xl relative z-10">{flag}</span>
                                                        <span className={`text-xs font-bold relative z-10 ${isPinned ? 'text-gray-800 dark:text-white' : 'text-gray-500'}`}>{code}</span>
                                                        {isPinned && <div className="absolute right-0 top-0 bottom-0 w-1 bg-brand-primary"></div>}
                                                        {isPinned && <div className="ml-auto text-brand-primary relative z-10"><div className="w-1.5 h-1.5 rounded-full bg-brand-primary"></div></div>}
                                                    </div>
                                                ); 
                                            })}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Contact Card */}
                        <div className="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-100 dark:border-gray-700 mt-4">
                            <h3 className="font-bold mb-4 flex items-center gap-2 text-gray-800 dark:text-white text-sm">
                                <span className="w-8 h-8 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center"><IconRenderer icon={Icons.Send} /></span> 
                                ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß
                            </h3>
                            <div className="grid grid-cols-2 gap-3">
                                <a href="https://t.me/Lairas24" target="_blank" className="flex items-center gap-3 p-3 rounded-xl bg-[#229ED9]/10 hover:bg-[#229ED9]/20 text-[#229ED9] transition-all border border-[#229ED9]/20">
                                    <IconRenderer icon={Icons.Send} />
                                    <span className="font-bold text-xs">ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ</span>
                                </a
                                >
                                <a href="https://www.facebook.com/share/1D74ZvQS9v/" target="_blank" className="flex items-center gap-3 p-3 rounded-xl bg-[#1877F2]/10 hover:bg-[#1877F2]/20 text-[#1877F2] transition-all border border-[#1877F2]/20">
                                    <IconRenderer icon={Icons.Facebook} />
                                    <span className="font-bold text-xs">ŸÅŸäÿ≥ÿ®ŸàŸÉ</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            );

            const renderTransfer = () => (
                <div className="fixed inset-0 bg-gray-900 z-50 flex flex-col animate-in fade-in duration-300 overflow-y-auto no-scrollbar">
                    <div className="flex justify-between items-center p-6"><h2 className="text-2xl font-bold text-white">ÿßŸÑÿ≠ŸàÿßŸÑÿßÿ™ ÿßŸÑŸÖÿßŸÑŸäÿ©</h2><button onClick={() => setActiveTab('home')} className="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-gray-400 hover:bg-gray-700 transition"><IconRenderer icon={Icons.X} /></button></div>
                    <div className="flex-1 px-6 pb-8 flex flex-col items-center">
                        <div className="w-full bg-gradient-to-br from-brand-dark to-[#0f2400] rounded-3xl p-6 mb-6 relative overflow-hidden border border-gray-700 shadow-2xl">
                            <div className="absolute top-0 right-0 w-32 h-32 bg-brand-primary/10 rounded-full blur-3xl translate-x-10 -translate-y-10"></div>
                            <div className="relative z-10 flex flex-col items-center text-center"><div className="w-16 h-16 bg-brand-primary/20 rounded-2xl flex items-center justify-center mb-4 border border-brand-primary/30 backdrop-blur-sm"><span className="text-3xl text-brand-primary">‚ÇÆ</span></div><h3 className="text-white text-xl font-bold mb-1">ŸÜŸÇÿ®ŸÑ ÿßŸÑÿØŸÅÿπ ÿßŸÑÿ±ŸÇŸÖŸä</h3><p className="text-brand-primary text-sm font-mono bg-brand-primary/10 px-3 py-1 rounded-full border border-brand-primary/20 mb-4">USDT (TRC20) Supported</p><p className="text-gray-300 text-sm leading-relaxed">ÿ≠ŸàŸëŸÑ ÿ£ŸÖŸàÿßŸÑŸÉ ŸÖŸÜ ÿ£Ÿä ŸÖŸÉÿßŸÜ ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖ ÿ•ŸÑŸâ ÿ≥Ÿàÿ±Ÿäÿß ŸàŸÉÿßŸÅÿ© ÿ£ŸÜÿ≠ÿßÿ° ÿßŸÑÿπÿßŸÑŸÖ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿπŸÖŸÑÿßÿ™ ÿßŸÑÿ±ŸÇŸÖŸäÿ©. ÿßÿ≥ÿ™ŸÑÿßŸÖ ŸÅŸàÿ±Ÿä Ÿàÿ¢ŸÖŸÜ.</p></div>
                        </div>
                        <div className="grid grid-cols-2 gap-3 w-full mb-8">
                            <div className="bg-gray-800/50 p-4 rounded-2xl border border-gray-700/50 flex flex-col items-center text-center gap-2"><div className="text-blue-400"><IconRenderer icon={Icons.Shield} /></div><span className="text-gray-200 font-bold text-sm">ÿ¢ŸÖŸÜ 100%</span></div>
                            <div className="bg-gray-800/50 p-4 rounded-2xl border border-gray-700/50 flex flex-col items-center text-center gap-2"><div className="text-yellow-400"><IconRenderer icon={Icons.Zap} /></div><span className="text-gray-200 font-bold text-sm">ÿ™ÿ≠ŸàŸäŸÑ ŸÑÿ≠ÿ∏Ÿä</span></div>
                            <div className="bg-gray-800/50 p-4 rounded-2xl border border-gray-700/50 flex flex-col items-center text-center gap-2"><div className="text-green-400"><IconRenderer icon={Icons.Wallet} /></div><span className="text-gray-200 font-bold text-sm">ÿπŸÖŸàŸÑÿßÿ™ ŸÖŸÜÿßŸÅÿ≥ÿ©</span></div>
                            <div className="bg-gray-800/50 p-4 rounded-2xl border border-gray-700/50 flex flex-col items-center text-center gap-2"><div className="text-purple-400"><IconRenderer icon={Icons.Globe} /></div><span className="text-gray-200 font-bold text-sm">ÿ™ÿ∫ÿ∑Ÿäÿ© ÿ¥ÿßŸÖŸÑÿ©</span></div>
                        </div>
                        <div className="w-full mt-auto"><p className="text-center text-gray-400 text-xs mb-4">Ÿäÿ™ŸÖ ÿ™ŸÜŸÅŸäÿ∞ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸàÿßŸÑÿßÿ™ ŸäÿØŸàŸäÿßŸã ÿπÿ®ÿ± ŸÅÿ±ŸäŸÇ ÿßŸÑÿØÿπŸÖ ŸÑÿ∂ŸÖÿßŸÜ ÿßŸÑÿ£ŸÖÿßŸÜ</p><a href="https://t.me/Lairas24" target="_blank" className="group w-full bg-brand-primary hover:bg-green-400 text-brand-dark font-bold py-4 rounded-xl flex items-center justify-center gap-3 transition-all duration-300 shadow-[0_0_20px_rgba(46,208,110,0.3)] hover:shadow-[0_0_30px_rgba(46,208,110,0.5)]"><svg className="w-6 h-6 transition-transform group-hover:-translate-y-1 group-hover:translate-x-1" viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0 12 12c0 6.627-5.373 12-12 12S0 18.627 0 12 5.373 0 12 0Zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635Z"/></svg><span className="text-lg">ÿ®ÿØÿ° ÿ™ÿ≠ŸàŸäŸÑ USDT</span></a></div>
                    </div>
                </div>
            );

            const NavBar = () => (
                 <div className="fixed bottom-6 left-4 right-4 md:left-1/2 md:right-auto md:-translate-x-1/2 md:w-full md:max-w-sm z-50">
                    <div className="bg-white/95 dark:bg-gray-800/95 backdrop-blur-xl rounded-[2.5rem] shadow-[0_10px_40px_-10px_rgba(0,0,0,0.15)] dark:shadow-black/50 border border-white/50 dark:border-gray-700/50 p-2 flex justify-between items-center h-[72px]">
                        
                        {/* Home Button */}
                        <button onClick={() => setActiveTab('home')} className={`relative flex flex-col items-center justify-center w-14 h-full rounded-2xl transition-all duration-500 group ${activeTab === 'home' ? 'text-brand-primary' : 'text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'}`}>
                            <div className={`transition-transform duration-300 ${activeTab === 'home' ? '-translate-y-1' : 'group-active:scale-90'}`}>
                                <IconRenderer icon={Icons.Home} />
                            </div>
                            {activeTab === 'home' && <span className="absolute bottom-2 w-1.5 h-1.5 bg-brand-primary rounded-full animate-in zoom-in duration-300"></span>}
                        </button>

                        {/* Calc Button */}
                        <button onClick={() => setActiveTab('calc')} className={`relative flex flex-col items-center justify-center w-14 h-full rounded-2xl transition-all duration-500 group ${activeTab === 'calc' ? 'text-brand-primary' : 'text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'}`}>
                            <div className={`transition-transform duration-300 ${activeTab === 'calc' ? '-translate-y-1' : 'group-active:scale-90'}`}>
                                <IconRenderer icon={Icons.Chart} />
                            </div>
                            {activeTab === 'calc' && <span className="absolute bottom-2 w-1.5 h-1.5 bg-brand-primary rounded-full animate-in zoom-in duration-300"></span>}
                        </button>

                        {/* Transfer Button (Center) */}
                        <div className="relative -top-6">
                            <button onClick={() => setActiveTab('transfer')} className="w-16 h-16 bg-brand-primary text-brand-dark rounded-[1.2rem] shadow-xl shadow-brand-primary/40 flex items-center justify-center transform transition-all duration-300 hover:scale-105 active:scale-95 border-[6px] border-gray-100 dark:border-gray-900 overflow-hidden relative group">
                                <div className="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                                <IconRenderer icon={Icons.Send} />
                            </button>
                        </div>

                        {/* Gold Button */}
                        <button onClick={() => setActiveTab('gold')} className={`relative flex flex-col items-center justify-center w-14 h-full rounded-2xl transition-all duration-500 group ${activeTab === 'gold' ? 'text-brand-primary' : 'text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'}`}>
                            <div className={`transition-transform duration-300 ${activeTab === 'gold' ? '-translate-y-1' : 'group-active:scale-90'}`}>
                                <IconRenderer icon={Icons.Coins} />
                            </div>
                            {activeTab === 'gold' && <span className="absolute bottom-2 w-1.5 h-1.5 bg-brand-primary rounded-full animate-in zoom-in duration-300"></span>}
                        </button>

                        {/* Global Button */}
                        <button onClick={() => setActiveTab('global')} className={`relative flex flex-col items-center justify-center w-14 h-full rounded-2xl transition-all duration-500 group ${activeTab === 'global' ? 'text-brand-primary' : 'text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'}`}>
                            <div className={`transition-transform duration-300 ${activeTab === 'global' ? '-translate-y-1' : 'group-active:scale-90'}`}>
                                <IconRenderer icon={Icons.Globe} />
                            </div>
                            {activeTab === 'global' && <span className="absolute bottom-2 w-1.5 h-1.5 bg-brand-primary rounded-full animate-in zoom-in duration-300"></span>}
                        </button>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-100 dark:bg-gray-900 max-w-md mx-auto relative shadow-2xl overflow-hidden">
                    <InstallPrompt />
                    {showSplash && <SplashScreen />}
                    
                    {activeTab === 'home' && renderHome()}
                    {activeTab === 'gold' && renderGold()}
                    {activeTab === 'calc' && renderCalculator()}
                    {activeTab === 'settings' && renderSettings()}
                    {activeTab === 'transfer' && renderTransfer()}
                    {activeTab === 'global' && renderGlobal()}
                    {activeTab !== 'transfer' && <NavBar />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
